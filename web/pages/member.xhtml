<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/template/modeloSistema.xhtml">

    <ui:define name="menu">
        <ui:include src="/pages/menu.xhtml" />        
    </ui:define>

    <ui:define name="conteudo">
        <h:form id="formTblMember">
            <p:dataTable id="tblMember" emptyMessage="Nenhum Membro encontrado." 
                         value="#{MBMember.memberList}" 
                         var="member"                     
                         paginator="true"
                         rows="10"
                         
                         selectionMode="single"
                         selection="#{MBMember.member}" 
                         rowKey="#{member.idMember}">

                <p:ajax event="rowSelect" listener="#{MBMember.onRowSelect}" update="ExcluirBtn EditBtn" />
                <p:ajax event="rowUnselect" listener="#{MBMember.onRowUnselect(event)}" update="ExcluirBtn EditBtn" />

                <f:facet name="header" >
                    Relação Geral de Membros do Clube
                </f:facet>

                <p:column headerText="Código" sortBy="#{member.idMember}">
                    <h:outputText value="#{member.idMember}" />
                </p:column>

                <p:column headerText="Nome" sortBy="#{member.nomeMember}">
                    <h:outputText value="#{member.nomeMember}" />
                </p:column>

                <p:column headerText="Função" sortBy="#{member.nivelAcesso.funcao}">
                    <h:outputText value="#{member.nivelAcesso.funcao}" />
                </p:column>

                <p:column headerText="Data Nascimento" sortBy="#{MBMember.getFormatoBr(member.dtNascimento)}">
                    <h:outputText value="#{MBMember.getFormatoBr(member.dtNascimento)}" />
                </p:column>

                <p:column headerText="Endereço" sortBy="#{member.endereco}">
                    <h:outputText value="#{member.endereco}" />
                </p:column>

                <p:column headerText="CPF" sortBy="#{member.cpf}">
                    <h:outputText value="#{member.cpf}" />
                </p:column>

                <p:column headerText="RG" sortBy="#{member.rg}">
                    <h:outputText value="#{member.rg}" />
                </p:column>

                <p:column headerText="Telefone" sortBy="#{member.telefone}">
                    <h:outputText value="#{member.telefone}" />
                </p:column>

                <p:column headerText="Email" sortBy="#{member.email}">
                    <h:outputText value="#{member.email}" />
                </p:column>

                <f:facet id="facetBtn" name="footer">
                    <p:commandButton icon="ui-icon-circle-plus"  actionListener="#{MBMember.prepararMember()}"
                                     oncomplete="PF('newMember').show()"
                                     update=":formPnlNewMember:pnlNewMember" />

                    <p:commandButton id="ExcluirBtn" disabled="#{!MBMember.selecionado}" icon="ui-icon-trash" 
                                     oncomplete="PF('deleteMember').show()"
                                     update=":formPnlDeleteMember:pnlDeleteMember"/>

                    <p:commandButton id="EditBtn" disabled="#{!MBMember.selecionado}"
                                     icon="ui-icon-pencil"
                                     oncomplete="PF('editMember').show()"
                                     update=":formPnlEditMember:pnlEditMember" />

                </f:facet>
            </p:dataTable>
        </h:form>   

        <p:dialog id="newMember" widgetVar="newMember"
                  closable="false"
                  draggable="true"
                  resizable="false"
                  modal="true" appendTo="@(body)"
                  header="Cadastro de Membro do Clube - PREENCHA TODOS OS DADOS">

            <h:form id="formPnlNewMember">
                <h:panelGrid id="pnlNewMember" columns="2">
                    
                    <p:outputLabel value="Nome" />
                    <p:inputText size="30" required="true" requiredMessage="Campo nome requerido" maxlength="30" value="#{MBMember.member.nomeMember}"/>

                    <p:outputLabel value="Função" />
                    <p:selectOneMenu effect="slide" value="#{MBMember.member.nivelAcesso}">   

                    <p:outputLabel value="Endereço" />
                    <p:inputText size="30" maxlength="30" value="#{MBMember.member.endereco}"/>
                        <f:selectItems value="#{MBMember.nivel}" var="nivel" itemValue="#{nivel}" itemLabel="#{nivel.funcao}"/>                       
                    </p:selectOneMenu>

                    <p:outputLabel  value="Data de Nascimento" />
                    <p:calendar required="true" requiredMessage="Insira uma data de Nascimento" locale="pt_BR" pattern="dd/MM/yyyy" mask="true" navigator="true" readonlyInput="true" maxdate="c+0" yearRange="c-100:c+100" value="#{MBMember.member.dtNascimento}"/>

                    <p:outputLabel value="CPF" />
                    <p:inputMask mask="999.999.999-99" id="cpf" value="#{MBMember.member.cpf}" />

                    <p:outputLabel value="RG" />
                    <p:inputMask mask="99.999.999-9" id="rg" value="#{MBMember.member.rg}" />

                    <p:outputLabel value="E-Mail" />
                    <p:inputText size="30" maxlength="30"/>

                    <p:outputLabel value="Telefone" />
                    <p:inputText size="30" maxlength="30"/>

                </h:panelGrid>

                <h:panelGrid columns="2">
                    <p:commandButton value="Salvar" actionListener="#{MBMember.saveMember()}"
                                     oncomplete="PF('newMember').hide();" 
                                     update=":formTblMember:tblMember :msgGlobal" />
                    <p:commandButton value="Cancelar" onclick="PF('newMember').hide();"/>                    
                </h:panelGrid> 
               
            </h:form>
        </p:dialog>

        <p:dialog id="deleteMember" widgetVar="deleteMember"
                  closable="false"
                  draggable="true"
                  resizable="false"
                  modal="true" appendTo="@(body)"
                  header="Exclusão de Membro do Clube ">

            <h:form id="formPnlDeleteMember" >
                <h:panelGrid id="pnlDeleteMember" columns="2">
                    <p:outputLabel value="Nome" />
                    <p:inputText readonly="true" value="#{MBMember.member.nomeMember}"/>

                    <p:outputLabel value="Função" />
                    <p:inputText readonly="true" value="#{MBMember.member.nivelAcesso}"/>

                    <p:outputLabel  value="Data de Nascimento" />
                    <p:inputText readonly="true"  value="#{MBMember.member.dtNascimento}"/>

                    <p:outputLabel value="Endereço" />
                    <p:inputText readonly="true" value="#{MBMember.member.endereco}"/>

                    <p:outputLabel value="CPF" />
                    <p:inputText readonly="true" value="#{MBMember.member.cpf}" />

                    <p:outputLabel value="RG" />
                    <p:inputText readonly="true" value="#{MBMember.member.rg}" />

                    <p:outputLabel value="E-Mail" />
                    <p:inputText readonly="true"/>

                    <p:outputLabel value="Telefone" />
                    <p:inputText readonly="true" />

                </h:panelGrid>

                <h:panelGrid columns="2">
                    <p:commandButton value="Excluir" actionListener="#{MBMember.deleteMember()}"
                                     oncomplete="PF('deleteMember').hide();" 
                                     update=":formTblMember:tblMember :msgGlobal "
                                     action="#{MBMember.setSelecionado(false)}"/>
                    <p:commandButton value="Cancelar" onclick="PF('deleteMember').hide();"/>
                </h:panelGrid>                                

            </h:form>

        </p:dialog>
        
        <p:dialog id="editMember" widgetVar="editMember"
                  closable="false"
                  draggable="true"
                  resizable="false"
                  modal="true" appendTo="@(body)"
                  header="Editar Membro do Clube - PREENCHA TODOS OS DADOS">

            <h:form id="formPnlEditMember">
                <h:panelGrid id="pnlEditMember" columns="2">
                    
                    <p:outputLabel value="Nome" />
                    <p:inputText size="30" required="true" requiredMessage="Campo nome requerido" maxlength="30" value="#{MBMember.member.nomeMember}"/>

                    <p:outputLabel value="Função" />
                    <p:selectOneMenu effect="slide" value="#{MBMember.member.nivelAcesso}">   

                    <p:outputLabel value="Endereço" />
                    <p:inputText size="30" maxlength="30" value="#{MBMember.member.endereco}"/>
                        <f:selectItems value="#{MBMember.nivel}" var="nivel" itemValue="#{nivel}" itemLabel="#{nivel.funcao}"/>                       
                    </p:selectOneMenu>

                    <p:outputLabel  value="Data de Nascimento" />
                    <p:calendar required="true" requiredMessage="Insira uma data de Nascimento" locale="pt_BR" pattern="dd/MM/yyyy" mask="true" navigator="true" readonlyInput="true" maxdate="c+0" yearRange="c-100:c+100" value="#{MBMember.member.dtNascimento}"/>

                    <p:outputLabel value="CPF" />
                    <p:inputMask mask="999.999.999-99" id="cpf" value="#{MBMember.member.cpf}" />

                    <p:outputLabel value="RG" />
                    <p:inputMask mask="99.999.999-9" id="rg" value="#{MBMember.member.rg}" />

                    <p:outputLabel value="E-Mail" />
                    <p:inputText size="30" maxlength="30"/>

                    <p:outputLabel value="Telefone" />
                    <p:inputText size="30" maxlength="30"/>

                </h:panelGrid>

                <h:panelGrid columns="2">
                    <p:commandButton value="Salvar" actionListener="#{MBMember.saveMember()}"
                                     oncomplete="PF('editMember').hide();" 
                                     update=":formTblMember:tblMember :msgGlobal"
                                     action="#{MBMember.setSelecionado(false)}"/>
                    <p:commandButton value="Cancelar" onclick="PF('editMember').hide();"/>
                </h:panelGrid>                                

            </h:form>
        </p:dialog>

    </ui:define>

</ui:composition>
